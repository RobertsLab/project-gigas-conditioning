---
title: "Survival_analysis"
output: html_document
date: "2024-06-26"
---

### Load libraries
```{r}
library(readxl)
library(tidyverse)
library(ggplot2)
```

### Load Data
```{r}
# B survival
B_survival_06202024 <- read_excel("/Users/graceleuchtenberger/Library/Mobile Documents/com~apple~CloudDocs/Documents/project-gigas-conditioning-GL/data/survival/Westcott/B_survival_06202024.xlsx")
B_survival_06252024 <- read_excel("/Users/graceleuchtenberger/Library/Mobile Documents/com~apple~CloudDocs/Documents/project-gigas-conditioning-GL/data/survival/Westcott/B_survival_06252024.xlsx")

# D survival
D_survival_06202024 <- read_excel("/Users/graceleuchtenberger/Library/Mobile Documents/com~apple~CloudDocs/Documents/project-gigas-conditioning-GL/data/survival/Westcott/D_survival_06202024.xlsx")
D_survival_06252024 <- read_excel("/Users/graceleuchtenberger/Library/Mobile Documents/com~apple~CloudDocs/Documents/project-gigas-conditioning-GL/data/survival/Westcott/D_survival_06252024.xlsx")
```

### Combine data, reup it
```{r}
B_live <- bind_cols(bag_num = B_survival_06202024$bag_num,
               alive_1 = B_survival_06202024$alive_num,
               alive_2 = B_survival_06252024$alive_num)

D_live <- bind_cols(bag_num = D_survival_06202024$bag_num,
               alive_1 = D_survival_06202024$alive_num,
               alive_2 = D_survival_06252024$alive_num)

live <- rbind(B_live, D_live)

live$treatment <- NA

for (i in 1:length(live$treatment)){
  if (live$bag_num[i] < 6) {
    live$treatment[i] <- "b_control"
  }
  if (live$bag_num[i] >= 6 & live$bag_num[i] < 11){
    live$treatment[i] <- "b_treated"
  }
  if (live$bag_num[i] >= 11 & live$bag_num[i] < 22){
    live$treatment[i] <- "d_control"
  }
  if (live$bag_num[i] >= 22){
    live$treatment[i] <- "d_treated"
  }
}

live <- live %>%
  pivot_longer(cols = c(alive_1, alive_2), names_to = "time_points", values_to = "live_oysters")

```

### Stats
```{r}
means_live <- live %>%
  group_by(treatment, time_points) %>%
  summarize(mean_live = mean(live_oysters, na.rm = TRUE))

ggplot(means_live, aes(x = time_points, y = mean_live, group = treatment, color = treatment)) +
  geom_line() +
  geom_point() +
  labs(x = "Time Point",
       y = "Mean live oysters per bag") +
  theme_classic()+
  ylim(0,105)

```

### B plots
```{r}
B_means <- means_live %>% 
  filter(treatment %in% c("b_control", "b_treated"))

ggplot(B_means, aes(x = time_points, y = mean_live, group = treatment, color = treatment)) +
  geom_line() +
  geom_point() +
  labs(x = "Time Point",
       y = "Mean live oysters per bag") +
  theme_classic()+
  ylim(0,60)

```
### D plots
```{r}
D_means <- means_live %>% 
  filter(treatment %in% c("d_control", "d_treated"))

ggplot(D_means, aes(x = time_points, y = mean_live, group = treatment, color = treatment)) +
  geom_line() +
  geom_point() +
  labs(x = "Time Point",
       y = "Mean live oysters per bag") +
  theme_classic()+
  ylim(0,105)

```
