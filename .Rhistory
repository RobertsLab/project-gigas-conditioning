tbl_regression(exp = TRUE)
# Chunk 17
my_theme<-theme_classic()
# Chunk 18
plot1<-survfit2(Surv(time, status) ~ treatment, data = control_d) %>%
ggsurvfit() +
labs(
x = "Hours",
y = "Survival probability",
title="Effort D (Weekly Temp) 18°C"
)+
ylim(0,1)+
my_theme+
geom_text(x=10, y=0.2, label="Cox PH p>0.05")+
#geom_text(x=10, y=0.2, label="Cox PH p=0.8")+
theme(legend.position="none")
# Chunk 19
plot2<-survfit2(Surv(time, status) ~ treatment, data = stress_d) %>%
ggsurvfit() +
labs(
x = "Hours",
y = "Survival probability",
title = "Effort D (Weekly Temp) 46°C"
)+
ylim(0,1)+
my_theme+
geom_text(x=10, y=0.2, label="Cox PH p>0.05")+
#geom_text(x=10, y=0.15, label="Temperature vs control p=0.002")+
#geom_text(x=10, y=0.10, label="All others vs control p>0.05")+
theme(legend.position="right")
# Chunk 20
plots<-plot_grid(plot1, plot2, rel_widths=c(0.65,1), ncol=2)
ggsave(plots, filename="figures/survival/KMcurves_EffortD.png", width=10, height=4)
s1 <- survfit(Surv(time, status) ~ treatment, data = control_b)
str(s1)
survfit2(Surv(time, status) ~ treatment+temperature, data = control_b) %>%
ggsurvfit() +
labs(
x = "Hours",
y = "Survival probability"
)
summary(survfit(Surv(time, status) ~ treatment, data = control_b), times = 24)
survdiff(Surv(time, status) ~ treatment, data = control_b)
coxph(Surv(time, status) ~ treatment, data = control_b) %>%
tbl_regression(exp = TRUE)
s2 <- survfit(Surv(time, status) ~ treatment, data = stress_b)
str(s2)
survfit2(Surv(time, status) ~ treatment+temperature, data = stress_b) %>%
ggsurvfit() +
labs(
x = "Hours",
y = "Survival probability"
)
summary(survfit(Surv(time, status) ~ treatment, data = stress_b), times = 24)
survdiff(Surv(time, status) ~ treatment, data = stress_b)
coxph(Surv(time, status) ~ treatment, data = stress_b)
coxph(Surv(time, status) ~ treatment, data = stress_b) %>%
tbl_regression(exp = TRUE)
my_theme<-theme_classic()
plot1<-survfit2(Surv(time, status) ~ treatment, data = control_b) %>%
ggsurvfit() +
labs(
x = "Hours",
y = "Survival probability",
title="Effort B (Daily Temp) 18°C"
)+
ylim(0,1)+
my_theme+
geom_text(x=10, y=0.2, label="Cox PH p>0.05")+
#geom_text(x=10, y=0.2, label="Cox PH p=0.8")+
theme(legend.position="none")
plot1
plot2<-survfit2(Surv(time, status) ~ treatment, data = stress_b) %>%
ggsurvfit() +
labs(
x = "Hours",
y = "Survival probability",
title = "Effort B (Daily Temp) 46°C"
)+
ylim(0,1)+
my_theme+
geom_text(x=10, y=0.2, label="Cox PH p>0.05")+
#geom_text(x=10, y=0.15, label="Temperature vs control p=0.002")+
#geom_text(x=10, y=0.10, label="All others vs control p>0.05")+
theme(legend.position="right")
plot2
coxph(Surv(time, status) ~ treatment, data = stress_b)
plot2<-survfit2(Surv(time, status) ~ treatment, data = stress_b) %>%
ggsurvfit() +
labs(
x = "Hours",
y = "Survival probability",
title = "Effort B (Daily Temp) 46°C"
)+
ylim(0,1)+
my_theme+
geom_text(x=10, y=0.2, label="Cox PH p<0.01")+
#geom_text(x=10, y=0.15, label="Temperature vs control p=0.002")+
#geom_text(x=10, y=0.10, label="All others vs control p>0.05")+
theme(legend.position="right")
plot2
plots<-plot_grid(plot1, plot2, rel_widths=c(0.65,1), ncol=2)
ggsave(plots, filename="figures/survival/KMcurves_EffortB.png", width=10, height=4)
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
# Chunk 2
library(tidyverse)
library(stringr)
library(readxl)
library(purrr)
library(lubridate)
library(ggplot2)
library(seacarb)
library(broom)
library(cowplot)
# Chunk 3
tidbit.files <- list.files(path="data/environmental/loggers/point_whitney/for-analysis", pattern="*.csv", full.names=TRUE)
#will need to change to HST time
tidbits <- setNames(tidbit.files, tidbit.files) %>%
map_dfr(read_csv, .id = "logger") %>%
rename(DateTime=`Date-Time (PDT)`, temp.C=`Temp   (°C)`)%>%
select(!`#`)%>%
select(logger, DateTime, temp.C)%>%
mutate(logger=sub(".*/", "", logger))%>% #remove the path name
mutate(logger=sub("_.*", "", logger))%>% #keep only the serial number
filter(!temp.C=="NA")
#format date for trays logger, formatted differently
trays<-tidbits%>%
filter(logger=="22023395")
other<-tidbits%>%
filter(!logger=="22023395")
trays$DateTime<-as.POSIXct(trays$DateTime, format="%m/%d/%y %H:%M")
other$DateTime<-as.POSIXct(other$DateTime, format="%m/%d/%Y %H:%M:%S")
tidbits<-rbind(trays,other)
# Chunk 4
levels(as.factor(tidbits$logger))
# Chunk 5
tidbits <- tidbits %>%
mutate(group = case_when(
logger == "22023395" ~ "trays",
logger == "22023398" ~ "outdoor",
logger == "22023406" ~ "broodstock",
logger == "22023410" ~ "LCO",
TRUE ~ "other"  # Default for other values
))
levels(as.factor(tidbits$group))
# Chunk 6
temp_plot<-tidbits%>%
ggplot(aes(x=DateTime, y=temp.C, colour=group, fill=group))+
geom_point(alpha=0.7)+
ylab("Temperature (°C)")+
xlab("Date Time")+
ylim(8,32)+
theme_classic(); temp_plot
ggsave(temp_plot, filename="figures/environmental/point-whitney-loggers.png", width=6, height=4)
# Chunk 7
westcott.files <- list.files(path="data/environmental/loggers/westcottloggers_20240913/", pattern="*.xlsx", full.names=TRUE)
#will need to change to HST time
westcott <- setNames(westcott.files, westcott.files) %>%
map_dfr(read_xlsx, .id = "logger") %>%
rename(DateTime=`Date-Time (PDT)`, temp.C=`Temperature (°C)`)%>%
select(!`#`)%>%
select(logger, DateTime, temp.C)%>%
mutate(logger=sub(".*/", "", logger))%>% #remove the path name
mutate(logger=sub("_.*", "", logger))%>% #keep only the serial number
filter(!temp.C=="NA")
westcott$DateTime<-as.POSIXct(westcott$DateTime, format="%m/%d/%Y %H:%M:%S")
# Chunk 8
levels(as.factor(westcott$logger))
# Chunk 9
westcott <- westcott %>%
mutate(group = c("Westcott"))
levels(as.factor(westcott$group))
# Chunk 10
westcott_plot<-westcott%>%
ggplot(aes(x=DateTime, y=temp.C, colour=logger, fill=logger))+
geom_point(alpha=0.7)+
ylab("Temperature (°C)")+
xlab("Date Time")+
ylim(0,50)+
theme_classic(); westcott_plot
ggsave(westcott_plot, filename="figures/environmental/westcott-loggers.png", width=10, height=6)
# Chunk 11
goose.files <- list.files(path="data/environmental/loggers/goose_point/", pattern="*.csv", full.names=TRUE)
#will need to change to HST time
goose <- setNames(goose.files, goose.files) %>%
map_dfr(read_csv, .id = "logger") %>%
rename(DateTime=`Date-Time (PDT)`, temp.C=`Temp   (°C)`)%>%
select(!`#`)%>%
select(logger, DateTime, temp.C)%>%
mutate(logger=sub(".*/", "", logger))%>% #remove the path name
mutate(logger=sub("_.*", "", logger))%>% #keep only the serial number
filter(!temp.C=="NA")
goose$DateTime<-as.POSIXct(goose$DateTime, format="%m/%d/%Y %H:%M:%S")
# Chunk 12
levels(as.factor(goose$logger))
# Chunk 13
goose <- goose %>%
mutate(group = c("Goose Point"))
levels(as.factor(goose$group))
# Chunk 14
goose_plot<-goose%>%
ggplot(aes(x=DateTime, y=temp.C, colour=logger, fill=logger))+
geom_point(alpha=0.7)+
ylab("Temperature (°C)")+
xlab("Date Time")+
ylim(0,50)+
theme_classic(); goose_plot
ggsave(goose_plot, filename="figures/environmental/goose-loggers.png", width=10, height=6)
temp_plot<-tidbits%>%
ggplot(aes(x=DateTime, y=temp.C, colour=group, fill=group))+
geom_point(alpha=0.7)+
ylab("Temperature (°C)")+
xlab("Date Time")+
ylim(8,32)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("broodstock", "LCO", "outdoor"))%>%
ggplot(aes(x=DateTime, y=temp.C, colour=group, fill=group))+
geom_point(alpha=0.7)+
ylab("Temperature (°C)")+
xlab("Date Time")+
ylim(8,32)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("broodstock", "LCO", "outdoor"))%>%
filter(temp.C>14)%>%
ggplot(aes(x=DateTime, y=temp.C, colour=group, fill=group))+
geom_point(alpha=0.7)+
ylab("Temperature (°C)")+
xlab("Date Time")+
ylim(8,32)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("broodstock", "LCO", "outdoor"))%>%
filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C, colour=group, fill=group))+
geom_point(alpha=0.7)+
ylab("Temperature (°C)")+
xlab("Date Time")+
ylim(8,32)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("broodstock", "LCO", "outdoor"))%>%
filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
ylab("Temperature (°C)")+
xlab("Date Time")+
ylim(8,32)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("broodstock", "LCO", "outdoor"))%>%
filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date Time")+
ylim(8,32)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("broodstock", "LCO", "outdoor"))%>%
filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("3-holer tanks")+
ylim(8,32)+
theme_classic(); temp_plot
ggsave(temp_plot, filename="figures/environmental/3-holer-tanks-PW.png", width=6, height=4)
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
ylim(8,32)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))
tidbits%>%
filter(group %in% c("trays"))
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(x=1)+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=1)+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=1, linetype="dashed")+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=100, linetype="dashed")+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=1000, linetype="dashed")+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=1000, linetype="dashed", colour="red")+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=5000, linetype="dashed", colour="red")+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=0.5, linetype="dashed", colour="red")+
ylim(8,25)+
theme_classic(); temp_plot
tidbits%>%
filter(group %in% c("trays"))
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=as.POSIXct("2024-06-12 13:45:00"), linetype="dashed", colour="red")+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=as.POSIXct("2024-08-12 13:45:00"), linetype="dashed", colour="red")+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=as.POSIXct("2024-08-6 13:45:00"), linetype="dashed", colour="red")+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=as.POSIXct("2024-08-05 13:45:00"), linetype="dashed", colour="red")+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=as.POSIXct("2024-08-05 15:45:00"), linetype="dashed", colour="red")+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=as.POSIXct("2024-08-05 15:45:00"), linetype="dashed", colour="red")+
geom_text(x=as.POSIXct("2024-08-01 15:45:00"), y=22, label="left stack")+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=as.POSIXct("2024-08-05 15:45:00"), linetype="dashed", colour="red")+
geom_text(x=as.POSIXct("2024-07-01 15:45:00"), y=22, label="left stack")+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=as.POSIXct("2024-08-05 15:45:00"), linetype="dashed", colour="red")+
geom_text(x=as.POSIXct("2024-07-01 15:45:00"), y=22, label="left stack")+
geom_text(x=as.POSIXct("2024-09-01 15:45:00"), y=22, label="right stack")+
ylim(8,25)+
theme_classic(); temp_plot
temp_plot<-tidbits%>%
filter(group %in% c("trays"))%>%
#filter(temp.C>15)%>%
ggplot(aes(x=DateTime, y=temp.C))+
geom_point(alpha=0.7, colour="gray")+
geom_smooth(colour="black")+
ylab("Temperature (°C)")+
xlab("Date")+
ggtitle("Seed trays")+
geom_vline(xintercept=as.POSIXct("2024-08-05 15:45:00"), linetype="dashed", colour="black")+
geom_text(x=as.POSIXct("2024-07-01 15:45:00"), y=22, label="left stack")+
geom_text(x=as.POSIXct("2024-09-01 15:45:00"), y=22, label="right stack")+
ylim(8,25)+
theme_classic(); temp_plot
ggsave(temp_plot, filename="figures/environmental/seed-trays-PW.png", width=6, height=4)
